<!DOCTYPE>

<html>

<head>
    <title>cytoscape-graphml.js demo</title>

    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1, maximum-scale=1">


    <script src="https://unpkg.com/cytoscape/dist/cytoscape.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.0.0.min.js"
        integrity="sha256-JmvOoLtYsmqlsWxa7mDSLMwa6dZ9rrIdtrrVYRnDRH0=" crossorigin="anonymous"></script>

    <!-- for testing with local version of cytoscape.js -->
    <!--<script src="../cytoscape.js/build/cytoscape.js"></script>-->

    <script src="cytoscape-graphml-ddp.js"></script>

    <style>
        body {
            font-family: helvetica neue, helvetica, liberation sans, arial, sans-serif;
            font-size: 14px;
        }

        #cy {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            right: 0;
            z-index: 999;
        }

        h1 {
            opacity: 0.5;
            font-size: 1em;
            font-weight: bold;
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', function () {

            fetch('http://127.0.0.1:5500/example-graffoo/rdfdata-template.graphml')
                .then(response => response.text())
                .then((data) => {

                    var graphStr = data;

                    var cy = window.cy = cytoscape({
                        container: document.getElementById('cy'),

                        style: [
                            {
                                selector: 'node',
                                style: {
                                    'content': 'data(d5)',
                                    'label': 'data(d5)',
                                    'text-opacity': 1,
                                    'text-valign': 'center',
                                    'text-halign': 'center',
                                    'text-wrap': 'wrap',
                                    'font-size': 12,
                                    'background-color': '#AAA',
                                    'shape': 'data(class)',
                                    'width': 'data(width)' ,
                                    'height': 'data(height)'
                                }
                            },

                            {
                                selector: 'edge',
                                style: {
                                    'target-arrow-shape': 'triangle'
                                }
                            },

                            {
                                selector: ':selected',
                                style: {

                                }
                            }
                        ],
                        ready: function () {
                            this.graphml({ layoutBy: 'preset' });
                            this.graphml(graphStr);
                            //console.log(this.graphml());
                        }
                    });

                    /**
                     * click del mouse su un elemento o sul fondo
                     */
                    cy.on('tap', function (event) {
                        // target holds a reference to the originator
                        // of the event (core or element)
                        var evtTarget = event.target;

                        //non si capisce perché this è diventato quello che doveva essere this.cy
                        //probabilmente perché sto dentro ad una funzione legata a this.cy
                        if (evtTarget === this) {
                            console.log('tap on background');
                        } else {
                            console.log('tap on ', evtTarget.data());
                        }

                    });


                });

        });

    </script>
</head>

<body>
    <h1>cytoscape-graphml demo</h1>

    <div id="cy"></div>

</body>

</html>